<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>shapez2-generator</title>
    <link type="text/css" rel="stylesheet" href="styles.css">
    <script type="application/javascript" src="https://cdn.jsdelivr.net/npm/jszip@2/dist/jszip.min.js"></script>
    <script type="application/javascript" src="https://cdn.jsdelivr.net/npm/file-saver@2"></script>
    <script type="application/javascript" src="composeApp.js"></script>
</head>
<body>
<!-- Splash Screen -->
<div id="splash-screen">
    <div class="logo-container">
        <img src="https://cdn.impress.games/presskits/b05b8fc32a22c183a871c2d84a102828/logos/3.png"
             alt="Shapez2 Logo"
             class="logo">
    </div>
    <div class="loading-text">SHAPEZ2 PROJECT GENERATOR</div>
    <div class="progress-container">
        <div class="progress-bar"></div>
    </div>
    <div class="loading-dots">Loading</div>
</div>

<script>
    // Function to hide splash screen
    // 100% claude vibecode btw (i hate js)
    function hideSplash() {
        const splash = document.getElementById('splash-screen');
        if (splash) {
            splash.classList.add('hidden');
            setTimeout(function() {
                splash.remove();
            }, 600);
        }
    }

    // Poll for Compose app initialization
    function checkComposeReady() {
        // Method 1: Check for canvas element (Compose usually creates a canvas)
        const canvas = document.querySelector('canvas');
        
        // Method 2: Check for a specific root div that Compose creates
        const composeRoot = document.getElementById('root') || document.querySelector('[data-compose-root]');
        
        // Method 3: Check if the skiko wasm module is loaded
        const wasmLoaded = typeof window.skia !== 'undefined' || 
                          typeof window.wasmExports !== 'undefined' ||
                          document.querySelector('canvas[data-skiko-canvas]');
        
        if (canvas || composeRoot || wasmLoaded) {
            console.log('Compose app detected as ready');
            setTimeout(hideSplash, 500);
            return true;
        }
        return false;
    }

    // Start polling after DOM is ready
    window.addEventListener('load', function() {
        let attempts = 0;
        const maxAttempts = 100; // 10 seconds max (100 * 100ms)
        
        const pollInterval = setInterval(function() {
            attempts++;
            
            if (checkComposeReady()) {
                clearInterval(pollInterval);
            } else if (attempts >= maxAttempts) {
                console.warn('Splash screen timeout - hiding anyway');
                clearInterval(pollInterval);
                hideSplash();
            }
        }, 100); // Check every 100ms
    });
</script>
</body>
</html>
